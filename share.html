<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>×©×™×ª×•×£ ×™×œ×“</title>
</head>
<body>

  <h2>×˜×•×¢×Ÿ × ×ª×•× ×™ ×©×™×ª×•×£...</h2>

  <!-- 1. ×˜×•×¢×Ÿ ××ª Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- 2. Firebase config â€“ ×œ×”×—×œ×™×£ ×‘×©×œ×š -->
  <script>
const firebaseConfig = {
  apiKey: "AIzaSyD9IzSor82cM39XgdLbywBdq-bM8m2c_ak",
  authDomain: "mykids-3f832.firebaseapp.com",
  projectId: "mykids-3f832",
  storageBucket: "mykids-3f832.firebasestorage.app",
  messagingSenderId: "869870400492",
  appId: "1:869870400492:web:80200b8102afb53e1c06c9",
  measurementId: "G-Q3X18J3SJ4",
  databaseURL:  "https://mykids-3f832-default-rtdb.firebaseio.com"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <!-- 3. ×§×•×“ ×”-share -->
  <script>
    const url = new URL(window.location.href);
    const shareId = url.searchParams.get("id");

    if (!shareId) {
      document.body.innerHTML = "<h3>×§×™×©×•×¨ ×”×©×™×ª×•×£ ×œ× ×ª×§×™×Ÿ.</h3>";
    }

    // ×§×¨×™××ª × ×ª×•× ×™ ×”×©×™×ª×•×£
    db.ref("shared/" + shareId).once("value").then(snapshot => {
      const data = snapshot.val();

      if (!data) {
        document.body.innerHTML = "<h3>×§×™×©×•×¨ ×–×” ××™× ×• ×¤×¢×™×œ ×™×•×ª×¨.</h3>";
        return;
      }

      const kid = data.kid;
      const kidId = kid.id;

      // ×™×¦×™×¨×ª ××–×”×” ××©×ª××© ×œ××™ ×©×¤×ª×— ××ª ×”×§×™×©×•×¨ (×× ××™×Ÿ)
      let currentUserId = localStorage.getItem("userId");
      if (!currentUserId) {
        currentUserId = "user_" + Date.now();
        localStorage.setItem("userId", currentUserId);
      }

      // ×©××™×¨×” ××¦×œ ×”××©×ª××© ×©×§×™×‘×œ ××ª ×”×©×™×ª×•×£
      db.ref("kids/" + currentUserId + "/" + kidId).set(kid)
        .then(() => {
          document.body.innerHTML = `
            <h2>×”×™×œ×“ × ×•×¡×£ ×‘×”×¦×œ×—×” ×œ×—×©×‘×•×Ÿ ×©×œ×š ğŸ‰</h2>
            <a href="index.html">×—×–×¨×” ×œ××¤×œ×™×§×¦×™×”</a>
          `;
        });

    });
  </script>
</body>
</html>
