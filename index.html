<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>הילדים שלי</title>

<style>
body { font-family: Arial, sans-serif; background: #f3f3f3; margin: 0; padding: 20px; }
h1 { text-align: center; }
#dateFilter { display: block; margin: 15px auto; padding: 6px; font-size: 16px; }

#kids-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.kid-box {
  background: white;
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
  font-size: 18px;
  cursor: pointer;
  position: relative;
}

.kid-box .delete-kid {
  position: absolute;
  top: 5px;
  right: 5px;
  cursor: pointer;
  color: red;
  font-weight: bold;
}

.kid-box .today-activities {
  margin-top: 8px;
  font-size: 0.85rem;
  color: #555;
}

#addKidBtn {
  display: block;
  width: 100%;
  padding: 15px;
  margin-top: 20px;
  font-size: 18px;
  border: none;
  background: #4CAF50;
  color: white;
  border-radius: 8px;
  cursor: pointer;
}

/* Modal */
#modalBackdrop {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  align-items: center;
  justify-content: center;
  z-index: 999;
}
#modal {
  background: white;
  border-radius: 12px;
  max-width: 400px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  padding: 20px;
}
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.close-btn { border: none; background: transparent; font-size: 1.3rem; cursor: pointer; }

.activity-list { margin-top: 10px; }
.activity-item {
  border-bottom: 1px solid #eee;
  padding: 6px 0;
  font-size: 0.9rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.activity-item button { background: red; color: white; border: none; border-radius: 4px; padding: 2px 6px; cursor: pointer; }

.add-activity-form { margin-top: 10px; display: flex; flex-direction: column; gap: 6px; }
.add-activity-form input { padding: 6px; font-size: 0.9rem; border-radius: 6px; border: 1px solid #ccc; }
.add-activity-form label { display: flex; align-items: center; gap: 6px; font-size: 0.9rem; }
.add-activity-form button { padding: 8px; border-radius: 6px; border: 1px solid #ccc; background: #f5f5f5; cursor: pointer; }
.add-activity-form button:hover { background: #e0e0e0; }

</style>
</head>
<body>

<h1>הילדים שלי</h1>
<input type="date" id="dateFilter">
<button id="addKidBtn">הוסף ילד</button>
<div id="kids-container"></div>

<!-- Modal -->
<div id="modalBackdrop">
  <div id="modal">
    <div class="modal-header">
      <div id="modalTitle"></div>
      <button class="close-btn" id="closeModal">&times;</button>
    </div>
    <div id="modalContent"></div>
  </div>
</div>

<!-- Firebase CDN scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ====== Firebase config ======
const firebaseConfig = {
  // כאן את מכניסה את הפרטים שלך
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const kidsContainer = document.getElementById("kids-container");
const addKidBtn = document.getElementById("addKidBtn");
const modalBackdrop = document.getElementById("modalBackdrop");
const modalTitle = document.getElementById("modalTitle");
const modalContent = document.getElementById("modalContent");
const closeModal = document.getElementById("closeModal");
const dateFilter = document.getElementById("dateFilter");

let currentKidId = null;

// ====== עזר ======
function getTodayStr() {
  const d = new Date();
  return d.toISOString().split("T")[0];
}

// ====== הוספת ילד ======
addKidBtn.addEventListener("click", () => {
  const name = prompt("שם הילד:");
  if (!name) return;
  db.ref("kids").push({ name, activities: [] });
});

// ====== טעינת ילדים ======
db.ref("kids").on("value", snapshot => {
  renderKids(snapshot.val());
});

// ====== render קוביות ילדים ======
function renderKids(kidsData) {
  kidsContainer.innerHTML = "";
  if (!kidsData) return;

  const selectedDate = dateFilter.value || getTodayStr();

  Object.keys(kidsData).forEach(id => {
    const kid = kidsData[id];
    const box = document.createElement("div");
    box.className = "kid-box";
    box.textContent = kid.name;

    // תצוגת פעילויות של היום
    const activitiesToday = (kid.activities || []).filter(a => a.date === selectedDate);
    const actDiv = document.createElement("div");
    actDiv.className = "today-activities";
    actDiv.textContent = activitiesToday.length
      ? activitiesToday.map(a => a.title).join(", ")
      : "אין פעילויות היום";
    box.appendChild(actDiv);

    // כפתור מחיקה
    const delBtn = document.createElement("span");
    delBtn.textContent = "×";
    delBtn.className = "delete-kid";
    delBtn.onclick = e => {
      e.stopPropagation();
      if (confirm(`למחוק את ${kid.name}?`)) {
        db.ref("kids/" + id).remove();
      }
    };
    box.appendChild(delBtn);

    box.onclick = () => openKidModal(id, kid);
    kidsContainer.appendChild(box);
  });
}

// ====== שינוי תאריך ======
dateFilter.addEventListener("change", () => {
  db.ref("kids").once("value").then(snap => renderKids(snap.val()));
});

// ====== modal פעילויות ======
function openKidModal(kidId, kid) {
  currentKidId = kidId;
  modalTitle.textContent = kid.name;
  modalContent.innerHTML = "";

  const selectedDate = dateFilter.value;

  const list = document.createElement("div");
  list.className = "activity-list";

  const activities = kid.activities || [];
  let filteredActivities = selectedDate ? activities.filter(a => a.date === selectedDate) : activities;

  if (!filteredActivities.length) {
    list.textContent = "אין פעילויות בתאריך זה.";
  } else {
    filteredActivities.forEach(a => {
      const item = document.createElement("div");
      item.className = "activity-item";
      item.textContent = `${a.date} ${a.time || ""} - ${a.title}`;

      const editBtn = document.createElement("button");
      editBtn.textContent = "עריכה";
      editBtn.onclick = () => editActivity(kidId, a, kid);

      const delBtn = document.createElement("button");
      delBtn.textContent = "×";
      delBtn.onclick = () => {
        const updated = activities.filter(act => act.id !== a.id);
        db.ref("kids/" + kidId + "/activities").set(updated);
        openKidModal(kidId, { ...kid, activities: updated });
      };

      item.appendChild(editBtn);
      item.appendChild(delBtn);
      list.appendChild(item);
    });
  }

  // טופס הוספת פעילות
  const form = document.createElement("form");
  form.className = "add-activity-form";

  const dateInput = document.createElement("input");
  dateInput.type = "date"; dateInput.required = true; dateInput.value = selectedDate || getTodayStr();

  const timeInput = document.createElement("input");
  timeInput.type = "time";

  const titleInput = document.createElement("input");
  titleInput.type = "text"; titleInput.required = true; titleInput.placeholder = "כותרת פעילות";

  const repeatInput = document.createElement("label");
  const repeatCheckbox = document.createElement("input");
  repeatCheckbox.type = "checkbox";
  repeatCheckbox.checked = false;
  repeatInput.appendChild(repeatCheckbox);
  repeatInput.appendChild(document.createTextNode("פעילות חוזרת שבועית"));

  const addBtn = document.createElement("button");
  addBtn.type = "submit"; addBtn.textContent = "הוסף פעילות";

  form.appendChild(dateInput);
  form.appendChild(timeInput);
  form.appendChild(titleInput);
  form.appendChild(repeatInput);
  form.appendChild(addBtn);

  form.addEventListener("submit", e => {
    e.preventDefault();
    const newActivity = {
      id: "a_" + Date.now(),
      date: dateInput.value,
      time: timeInput.value,
      title: titleInput.value,
      repeatWeekly: repeatCheckbox.checked
    };
    const updated = [...activities, newActivity];
    db.ref("kids/" + kidId + "/activities").set(updated);
    openKidModal(kidId, { ...kid, activities: updated });
  });

  modalContent.appendChild(list);
  modalContent.appendChild(form);

  modalBackdrop.style.display = "flex";
}

// ====== עריכת פעילות ======
function editActivity(kidId, activity, kid) {
  const newTitle = prompt("ערוך את שם הפעילות:", activity.title);
  if (!newTitle) return;
  const updated = kid.activities.map(a => a.id === activity.id ? { ...a, title: newTitle } : a);
  db.ref("kids/" + kidId + "/activities").set(updated);
  openKidModal(kidId, { ...kid, activities: updated });
}

closeModal.onclick = () => { modalBackdrop.style.display = "none"; currentKidId = null; };
modalBackdrop.onclick = e => { if (e.target === modalBackdrop) closeModal.onclick(); };

</script>
</body>
</html>
