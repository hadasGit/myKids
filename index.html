<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>הילדים שלי</title>

<style>
body { font-family: Arial, sans-serif; background: #f3f3f3; margin: 0; padding: 20px; }
h1 { text-align: center; }
#dateFilter { display:block; margin:15px auto; padding:6px; font-size:16px; }
#kids-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; margin-top: 20px; }
.kid-box { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0px 2px 5px rgba(0,0,0,0.1); font-size: 18px; cursor: pointer; position: relative; }
.delete-kid { position: absolute; top: 5px; right: 5px; cursor: pointer; color: red; font-weight: bold; }
#addKidBtn { display: block; width: 100%; padding: 15px; margin-top: 20px; font-size: 18px; border: none; background: #4CAF50; color: white; border-radius: 8px; cursor: pointer; }

/* Modal */
#modalBackdrop { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); align-items: center; justify-content: center; z-index: 999; }
#modal { background: white; border-radius: 12px; max-width: 400px; width: 90%; max-height: 80vh; overflow-y: auto; padding: 20px; }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.close-btn { border: none; background: transparent; font-size: 1.3rem; cursor: pointer; }
.activity-list { margin-top: 10px; }
.activity-item { border-bottom: 1px solid #eee; padding: 6px 0; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; }
.activity-item button { background: red; color: white; border: none; border-radius: 4px; padding: 2px 6px; cursor: pointer; margin-left:5px; }
.add-activity-form { margin-top: 10px; display: flex; flex-direction: column; gap: 6px; }
.add-activity-form input { padding: 6px; font-size: 0.9rem; border-radius: 6px; border: 1px solid #ccc; }
.add-activity-form button { padding: 8px; border-radius: 6px; border: 1px solid #ccc; background: #f5f5f5; cursor: pointer; }
.add-activity-form button:hover { background: #e0e0e0; }
.repeat-weekly { margin-left:5px; }
</style>
</head>
<body>

<h1>הילדים שלי</h1>
<input type="date" id="dateFilter">
<button id="addKidBtn">הוסף ילד</button>
<div id="kids-container"></div>

<!-- Modal -->
<div id="modalBackdrop">
  <div id="modal">
    <div class="modal-header">
      <div id="modalTitle"></div>
      <button class="close-btn" id="closeModal">&times;</button>
    </div>
    <div id="modalContent"></div>
  </div>
</div>

<!-- Firebase CDN scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ===== Firebase config =====
const firebaseConfig = {
  // כאן את שם הפרויקט והנתונים שלך
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const kidsContainer = document.getElementById("kids-container");
const addKidBtn = document.getElementById("addKidBtn");
const modalBackdrop = document.getElementById("modalBackdrop");
const modalTitle = document.getElementById("modalTitle");
const modalContent = document.getElementById("modalContent");
const closeModal = document.getElementById("closeModal");
const dateFilter = document.getElementById("dateFilter");

let currentKidId = null;

// ===== פונקציות עזר =====
function getTodayDateStr() {
  const d = new Date();
  const y = d.getFullYear(), m = String(d.getMonth()+1).padStart(2,"0"), day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}

function getSelectedDate() {
  return dateFilter.value || getTodayDateStr();
}

// ===== הוספת ילד =====
addKidBtn.addEventListener("click", () => {
  const name = prompt("שם הילד:");
  if (!name) return;
  db.ref("kids").push({ name, activities: [] });
});

// ===== טעינת ילדים =====
db.ref("kids").on("value", snapshot => renderKids(snapshot.val()));

// ===== renderKids =====
function renderKids(kids) {
  kidsContainer.innerHTML = "";
  if (!kids) return;
  const selectedDate = getSelectedDate();

  Object.keys(kids).forEach(id => {
    const kid = kids[id];
    const box = document.createElement("div");
    box.className = "kid-box";

    // שם הילד
    const nameDiv = document.createElement("div");
    nameDiv.textContent = kid.name;
    box.appendChild(nameDiv);

    // פעילויות של היום
    const activities = kid.activities || [];
    const todayActivities = activities.filter(a => a.date === selectedDate);
    const actDiv = document.createElement("div");
    actDiv.style.fontSize = "0.8rem";
    actDiv.style.marginTop = "6px";
    actDiv.textContent = todayActivities.length ? todayActivities.map(a=>`${a.time||""} ${a.title}`).join(", ") : "אין פעילויות ליום זה";
    box.appendChild(actDiv);

    // כפתור מחיקה של ילד
    const delBtn = document.createElement("span");
    delBtn.textContent = "×";
    delBtn.className = "delete-kid";
    delBtn.onclick = e => { e.stopPropagation(); if(confirm(`למחוק את ${kid.name}?`)){ db.ref("kids/"+id).remove(); } };
    box.appendChild(delBtn);

    box.onclick = () => openKidModal(id, kid);
    kidsContainer.appendChild(box);
  });
}

// ===== Modal פעילות =====
function openKidModal(kidId, kid) {
  currentKidId = kidId;
  modalTitle.textContent = kid.name;
  modalContent.innerHTML = "";

  const selectedDate = dateFilter.value;

  const activities = kid.activities || [];
  const filtered = selectedDate ? activities.filter(a=>a.date===selectedDate) : activities;

  // רשימת פעילויות
  const list = document.createElement("div");
  list.className = "activity-list";

  if(!filtered.length) list.textContent = "אין פעילויות";
  else filtered.forEach(a=>{
    const item = document.createElement("div");
    item.className = "activity-item";
    item.textContent = `${a.date} ${a.time||""} - ${a.title}`;

    const delBtn = document.createElement("button");
    delBtn.textContent="×";
    delBtn.onclick = () => {
      const updated = activities.filter(act=>act.id!==a.id);
      db.ref("kids/"+kidId+"/activities").set(updated);
      openKidModal(kidId,{...kid,activities:updated});
    };

    const editBtn = document.createElement("button");
    editBtn.textContent="✎";
    editBtn.onclick = () => {
      const newTitle = prompt("עריכת כותרת:", a.title);
      if(newTitle!==null){
        a.title = newTitle;
        db.ref("kids/"+kidId+"/activities").set(activities);
        openKidModal(kidId,kid);
      }
    };

    const repeatChk = document.createElement("input");
    repeatChk.type="checkbox";
    repeatChk.checked = a.repeatWeekly||false;
    repeatChk.className="repeat-weekly";
    repeatChk.title="פעילות חוזרת שבועית";
    repeatChk.onchange = () => {
      a.repeatWeekly = repeatChk.checked;
      db.ref("kids/"+kidId+"/activities").set(activities);
    };

    item.appendChild(editBtn);
    item.appendChild(delBtn);
    item.appendChild(repeatChk);
    list.appendChild(item);
  });

  // טופס הוספת פעילות
  const form = document.createElement("form");
  form.className = "add-activity-form";

  const dateInput = document.createElement("input");
  dateInput.type="date"; dateInput.required=true; dateInput.value=selectedDate||getTodayDateStr();

  const timeInput = document.createElement("input");
  timeInput.type="time";

  const titleInput = document.createElement("input");
  titleInput.type="text"; titleInput.required=true; titleInput.placeholder="כותרת פעילות";

  const addBtn = document.createElement("button");
  addBtn.type="submit"; addBtn.textContent="הוסף פעילות";

  form.appendChild(dateInput);
  form.appendChild(timeInput);
  form.appendChild(titleInput);
  form.appendChild(addBtn);

  form.addEventListener("submit", e=>{
    e.preventDefault();
    const newActivity = {
      id:"a_"+Date.now(),
      date:dateInput.value,
      time:timeInput.value,
      title:titleInput.value,
      repeatWeekly:false
    };
    db.ref("kids/"+kidId+"/activities").set([...activities,newActivity]);
    openKidModal(kidId,{...kid,activities:[...activities,newActivity]});
  });

  modalContent.appendChild(list);
  modalContent.appendChild(form);

  modalBackdrop.style.display="flex";
}

closeModal.onclick = () => { modalBackdrop.style.display="none"; currentKidId=null; };
modalBackdrop.onclick = e => { if(e.target===modalBackdrop) closeModal.onclick(); };

// ===== שינוי תאריך =====
dateFilter.addEventListener("change",()=>{
  db.ref("kids").once("value").then(snapshot=>renderKids(snapshot.val()));
});
</script>

</body>
</html>
