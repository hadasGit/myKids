<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>×”×™×œ×“×™× ×©×œ×™</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4CAF50">

<style>
body { font-family: Arial, sans-serif; background: #f3f3f3; margin: 0; padding: 20px; }
h1 { text-align: center; }

#kids-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  grid-gap: 10px;
}
  .kid-box { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0px 2px 5px rgba(0,0,0,0.1); font-size: 18px; cursor: pointer; position: relative; }
.delete-kid { position: absolute; top: 5px; right: 5px; cursor: pointer; color: red; font-weight: bold; }


@media (max-width: 600px) {
  #kids-container {
    grid-template-columns: 1fr;
  }
}

@media (min-width: 601px) and (max-width: 900px) {
  #kids-container {
    grid-template-columns: repeat(2, 1fr);
  }
}

  
  #addKidBtn { display: block; width: 100%; padding: 15px; margin-top: 20px; font-size: 18px; border: none; background: #4CAF50; color: white; border-radius: 8px; cursor: pointer; }
#dateFilter { display: block; margin: 0 !important; padding: 6px; font-size: 16px; }

/* Modal */
#modalBackdrop { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); align-items: center; justify-content: center; z-index: 999; }
#modal { background: white; border-radius: 12px; max-width: 400px; width: 90%; max-height: 80vh; overflow-y: auto; padding: 20px; }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.close-btn { border: none; background: transparent; font-size: 1.3rem; cursor: pointer; }
.activity-list { margin-top: 10px; }
.activity-item { border-bottom: 1px solid #eee; padding: 6px 0; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; }
.activity-item button { background: red; color: white; border: none; border-radius: 4px; padding: 2px 6px; cursor: pointer; }
.add-activity-form { margin-top: 10px; display: flex; flex-direction: column; gap: 6px; }
.add-activity-form input, .add-activity-form label { padding: 6px; font-size: 0.9rem; border-radius: 6px; border: 1px solid #ccc; }
.add-activity-form button { padding: 8px; border-radius: 6px; border: 1px solid #ccc; background: #f5f5f5; cursor: pointer; }
.add-activity-form button:hover { background: #e0e0e0; }
.permanent-note {
  background: #ffe5c2;      /* ×›×ª×•× ×‘×”×™×¨ */
  color: #c45d00;           /* ×›×ª×•× ×›×”×” */
  padding: 6px 10px;
  border-radius: 10px;
  font-size: 14px;
  margin-top: 6px;
  text-align: center;
  font-weight: bold;
  position: relative;       /* ×××¤×©×¨ ×œ××§× ×›×¤×ª×•×¨ ××—×™×§×” */
  white-space: nowrap;
  cursor: pointer;
  transition: all 0.2s;
}

/* ×›×¤×ª×•×¨ ××—×™×§×” ×‘×ª×•×š ×”×›×¨×˜×™×¡×™×” */
.permanent-note .del-btn {
  position: absolute;
  top: 2px;
  right: 4px;
  background: red;
  color: white;
  border-radius: 50%;
  padding: 0 4px;
  font-size: 10px;
  display: none;           /* ××•×¤×™×¢ ×¨×§ ×‘-hover */
  cursor: pointer;
}

/* ×”×¦×’×ª ×›×¤×ª×•×¨ ×”××—×™×§×” ×›×©×¢×•×‘×¨×™× ×¢× ×”×¢×›×‘×¨ ×¢×œ ×”×›×¨×˜×™×¡×™×” */
.permanent-note:hover .del-btn {
  display: inline-block;
} 
</style>
</head>
<body>

<h1>×”×™×œ×“×™× ×©×œ×™</h1>

  <div style="display:flex; align-items:center; gap:8px; justify-content:center;">
    <input type="date" id="dateFilter">

    <!-- ×›×¤×ª×•×¨ ×¨×¢× ×•×Ÿ ×¢× ××™×™×§×•×Ÿ -->
    <button id="refreshBtn" style="
        background:#e0e0e0;
        border:none;
        padding:6px 8px;
        border-radius:6px;
        cursor:pointer;
        display:flex;
        align-items:center;
        justify-content:center;
    ">
        ğŸ”„
    </button>
</div>
  
<button id="addKidBtn">×”×•×¡×£ ×™×œ×“</button>
<div id="kids-container"></div>

<!-- Modal -->
<div id="modalBackdrop">
  <div id="modal">
    <div class="modal-header">
      <div id="modalTitle"></div>
      <button class="close-btn" id="closeModal">&times;</button>
    </div>
    <div id="modalContent"></div>
  </div>
</div>

<!-- Firebase CDN scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD9IzSor82cM39XgdLbywBdq-bM8m2c_ak",
  authDomain: "mykids-3f832.firebaseapp.com",
  projectId: "mykids-3f832",
  storageBucket: "mykids-3f832.firebasestorage.app",
  messagingSenderId: "869870400492",
  appId: "1:869870400492:web:80200b8102afb53e1c06c9",
  measurementId: "G-Q3X18J3SJ4",
  databaseURL:  "https://mykids-3f832-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
// ×™×¦×™×¨×ª ××–×”×” ××©×ª××© ××•×˜×•××˜×™ ×•×©××™×¨×ª×• ×‘×“×¤×“×¤×Ÿ
let currentUserId = localStorage.getItem("currentUserId");

if (!currentUserId) {
  currentUserId = "user_" + Math.random().toString(36).substr(2, 9);
  localStorage.setItem("currentUserId", currentUserId);
}

console.log("User ID:", currentUserId);
const userKidsRef = db.ref(`users/${currentUserId}/kids`);

const kidsContainer = document.getElementById("kids-container");
const addKidBtn = document.getElementById("addKidBtn");
const modalBackdrop = document.getElementById("modalBackdrop");
const modalTitle = document.getElementById("modalTitle");
const modalContent = document.getElementById("modalContent");
const closeModal = document.getElementById("closeModal");
const dateFilter = document.getElementById("dateFilter");

let currentKidId = null;

// ====== ×¢×–×¨×” ×¢× ×ª××¨×™×š ×”×™×•× ======
  function getSelectedDate() {
  return dateFilter.value || getTodayDateStr();
}

function getTodayDateStr() {
  const d = new Date();
  const year = d.getFullYear();
  const month = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${year}-${month}-${day}`;
}
// ×¤×•× ×§×¦×™×” ×œ×§×‘×œ×ª ×ª××¨×™×š ×”×™×•× ×‘×¤×•×¨××˜ yyyy-mm-dd
//function todayStr() {
//  const d = new Date();
//  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
//}
function todayStr() {
  return new Date().toISOString().slice(0,10);
}
dateFilter.value = todayStr();

document.getElementById("refreshBtn").addEventListener("click", () => {
    userKidsRef.once("value").then(snapshot => {
        renderKids(snapshot.val());
      
     // snapshot => {
      //  const kids = snapshot.val();
      //  renderKids(kids, dateFilter.value || null);
    });
});
function closeModalFn() {
  modalBackdrop.style.display = "none";
  modalContent.innerHTML = "";
  modalTitle.textContent = "";
  currentKidId = null;
}

// ====== ×”×•×¡×¤×ª ×™×œ×“ ======
  addKidBtn.addEventListener("click", () => {
  const name = prompt("×©× ×”×™×œ×“:");
  if (!name) return;

  const newKidRef = userKidsRef.push(); // ×™×•×¦×¨×™× ××¤×ª×— ×¨××©×•×Ÿ
  const kidData = {
    id: newKidRef.key,    // ×©×•××¨ ××ª ×”××–×”×” ×‘×ª×•×š ×”××•×‘×™×™×§×˜
    name,
    activities: []
  };
  newKidRef.set(kidData);
});

//addKidBtn.addEventListener("click", () => {
 // const name = prompt("×©× ×”×™×œ×“:");
  //if (!name) return;
 // userKidsRef.push({ name, activities: [] });
//});

// Firebase reference ×œ××©×ª××© ×”× ×•×›×—×™
const currentUserId = localStorage.getItem("currentUserId") || (() => {
  const id = "user_" + Math.random().toString(36).substr(2, 9);
  localStorage.setItem("currentUserId", id);
  return id;
})();

const userKidsRef = db.ref(`users/${currentUserId}/kids`);

const kidsContainer = document.getElementById("kids-container");
const addKidBtn = document.getElementById("addKidBtn");

// ×ª××¨×™×š × ×•×›×—×™
function todayStr() {
  return new Date().toISOString().slice(0,10);
}
const dateFilter = document.getElementById("dateFilter");
dateFilter.value = todayStr();

// ====== ×”×•×¡×¤×ª ×™×œ×“ ======
addKidBtn.addEventListener("click", () => {
  const name = prompt("×©× ×”×™×œ×“:");
  if (!name) return;

  const newKidRef = userKidsRef.push();
  const kidData = {
    id: newKidRef.key,   // ××–×”×” ×¤× ×™××™
    name,
    activities: []
  };
  newKidRef.set(kidData);
});

// ====== ×˜×¢×™× ×ª ×™×œ×“×™× ======
userKidsRef.on("value", snapshot => {
  renderKids(snapshot.val());
});

// ====== renderKids ======
function renderKids(kids) {
  kidsContainer.innerHTML = "";
  if (!kids) return;

  const selectedDate = dateFilter.value || todayStr();

  Object.keys(kids).forEach(kidId => {
    const kid = kids[kidId];
    const box = document.createElement("div");
    box.className = "kid-box";

    // ×©× ×”×™×œ×“
    const nameEl = document.createElement("div");
    nameEl.textContent = kid.name;
    nameEl.style.fontWeight = "bold";
    nameEl.style.marginBottom = "6px";
    box.appendChild(nameEl);

    // ×¤×¢×™×œ×•×™×•×ª ×”×™×•×
    const activities = kid.activities || [];
    const todaysActivities = activities.filter(a =>
      !a.isPermanent &&
      (a.date === selectedDate || (a.repeatWeekly && new Date(a.date).getDay() === new Date(selectedDate).getDay()))
    );

    const actList = document.createElement("div");
    actList.style.marginTop = "6px";
    actList.style.fontSize = "0.9rem";

    if (todaysActivities.length === 0) {
      actList.textContent = "××™×Ÿ ×¤×¢×™×œ×•×™×•×ª ×”×™×•×";
      actList.style.color = "#555";
    } else {
      todaysActivities.forEach(a => {
        const aEl = document.createElement("div");
        aEl.style.display = "flex";
        aEl.style.alignItems = "center";
        aEl.style.justifyContent = "space-between";

        let text = `${a.time || "--:--"} - ${a.title}`;
        if (a.repeatWeekly) { text += " ğŸ”"; aEl.style.color = "#007BFF"; aEl.style.fontWeight="bold"; }
        if (a.isTransport) { text += " ğŸš—"; }
        aEl.textContent = text;

        actList.appendChild(aEl);
      });
    }
    box.appendChild(actList);

    // ×”×•×“×¢×•×ª ×§×‘×•×¢×•×ª
    const today = todayStr();
    const permanentNotes = activities.filter(a => a.isPermanent && a.date >= today);
    if (permanentNotes.length) {
      const notesContainer = document.createElement("div");
      notesContainer.style.display = "flex";
      notesContainer.style.flexWrap = "wrap";
      notesContainer.style.gap = "4px";
      notesContainer.style.marginTop = "6px";

      permanentNotes.forEach(note => {
        const noteDiv = document.createElement("div");
        noteDiv.className = "permanent-note";

        const formattedDate = note.date ? note.date.split("-").reverse().join("-") : "";
        const textSpan = document.createElement("span");
        textSpan.textContent = `${formattedDate} â€” ${note.title}`;
        noteDiv.appendChild(textSpan);

        // ×›×¤×ª×•×¨ ××—×™×§×”
        const delBtn = document.createElement("span");
        delBtn.textContent = "Ã—";
        delBtn.className = "del-btn";
        delBtn.onclick = e => {
          e.stopPropagation();
          if (confirm("×œ××—×•×§ ×”×•×“×¢×” ×§×‘×•×¢×” ×–×•?")) {
            const updated = activities.filter(a => a.id !== note.id);
            userKidsRef.child(kidId).child("activities").set(updated);
          }
        };
        noteDiv.appendChild(delBtn);

        noteDiv.onmouseover = () => delBtn.style.display = "inline-block";
        noteDiv.onmouseout = () => delBtn.style.display = "none";

        // ×¢×¨×™×›×” inline ×‘×œ×—×™×¦×” ×›×¤×•×œ×”
        noteDiv.ondblclick = e => {
          e.stopPropagation();
          textSpan.style.display = "none";

          const inputTitle = document.createElement("input");
          inputTitle.type = "text"; inputTitle.value = note.title; inputTitle.style.width="60%"; inputTitle.style.fontSize="12px";

          const inputDate = document.createElement("input");
          inputDate.type = "date"; inputDate.value = note.date; inputDate.style.fontSize="12px";

          const saveBtn = document.createElement("button");
          saveBtn.textContent = "×©××•×¨"; saveBtn.style.fontSize="12px";

          noteDiv.appendChild(inputTitle);
          noteDiv.appendChild(inputDate);
          noteDiv.appendChild(saveBtn);

          saveBtn.onclick = ev => {
            ev.stopPropagation();
            if (!inputTitle.value.trim() || !inputDate.value) { alert("×× × ××œ× ×›×•×ª×¨×ª ×•×ª××¨×™×š."); return; }

            const updatedAct = {...note, title: inputTitle.value.trim(), date: inputDate.value };
            const updated = activities.map(a => a.id === note.id ? updatedAct : a);
            userKidsRef.child(kidId).child("activities").set(updated);
          };
        };

        notesContainer.appendChild(noteDiv);
      });

      box.appendChild(notesContainer);
    }

    // ×›×¤×ª×•×¨ ××—×™×§×” ×©×œ ×”×™×œ×“
    const delKidBtn = document.createElement("span");
    delKidBtn.textContent = "Ã—";
    delKidBtn.className = "delete-kid";
    delKidBtn.onclick = e => {
      e.stopPropagation();
      if (confirm(`×œ××—×•×§ ××ª ${kid.name}?`)) {
        userKidsRef.child(kidId).remove();
      }
    };
    box.appendChild(delKidBtn);

    kidsContainer.appendChild(box);
  });
}

  // ×›×¤×ª×•×¨ ×©×™×ª×•×£
  const shareBtn = document.createElement("button");
  shareBtn.textContent = "×©×ª×£";
  shareBtn.style.marginTop = "6px";
  shareBtn.style.fontSize = "12px";
  shareBtn.style.padding = "4px 8px";
  shareBtn.style.cursor = "pointer";
  shareBtn.onclick = e => {
    e.stopPropagation(); // ×œ×× ×•×¢ ×¤×ª×™×—×ª Modal
    shareKid(id, kid);
  };
  
  box.appendChild(shareBtn);
}

    
   /* const permanentNotes = activities.filter(a => a.isPermanent && a.date >= today);
  
        permanentNotes.forEach(note => {
            const noteDiv = document.createElement("div");
            noteDiv.className = "permanent-note";
        
            // ××¦×™×’ ×’× ×ª××¨×™×š ×•×’× ×›×•×ª×¨×ª
            const formattedDate = note.date ? note.date.split("-").reverse().join("-") : "";
            noteDiv.textContent = `${formattedDate} â€” ${note.title}`;
        
            box.appendChild(noteDiv);
        });  
*/
    
//    const cleaned = activities.filter(a => {
//      if (a.isPermanent) return true;   // × ×©××¨ ×ª××™×“
//      return a.date >= new Date(selectedDate).getDay();           // ×ª××¨×™×›×™× ×©×¢×‘×¨×• × ××—×§×™×
//    });
  
//    if (cleaned.length !== activities.length) {
 //     db.ref("kids/" + id + "/activities").set(cleaned);
//      kid.activities = cleaned;
//    }
    
    // ×›×¤×ª×•×¨ ××—×™×§×” ×©×œ ×™×œ×“
    const delBtn = document.createElement("span");
    delBtn.textContent = "Ã—";
    delBtn.className = "delete-kid";
    delBtn.onclick = e => {
      e.stopPropagation();
      if (confirm(`×œ××—×•×§ ××ª ${kid.name}?`)) {
       userKidsRef.child(id).remove();
      }
    };
    box.appendChild(delBtn);

    // ×¤×ª×™×—×ª Modal
    box.onclick = () => openKidModal(id, kid);

    kidsContainer.appendChild(box);
  });
}
//db.ref("kids/" + targetUserId + "/" + kidId).set(kidData);

function shareKid(kidId, kid) {
  // ×¦×•×¨ ××–×”×” ×™×™×—×•×“×™ ×œ×©×™×ª×•×£
  const shareId = "share_" + Date.now();

  // ×©××•×¨ ×‘-Firebase ×ª×—×ª /shared
  db.ref("shared/" + shareId).set({
    kid,
    from: currentUserId // ××–×”×” ×”××©×ª××© ×©×©×•×œ×—
  })
  .then(() => {
    const link = `${window.location.origin}/myKids/share.html?id=${shareId}`;
    prompt("×§×™×©×•×¨ ×œ×©×™×ª×•×£ ×¢× ××©×ª××© ××—×¨:", link);
  })
  .catch(err => console.error("×©×’×™××” ×‘×©×™×ª×•×£:", err));
}



// ====== Modal ×¤×¢×™×œ×•×ª ======
function openKidModal(kidId, kid) {
  currentKidId = kidId;
  modalTitle.textContent = kid.name;
  modalContent.innerHTML = "";

  const selectedDate = dateFilter.value || todayStr();

  // ×¨×©×™××ª ×¤×¢×™×œ×•×™×•×ª
  const list = document.createElement("div");
  list.className = "activity-list";

  const activities = kid.activities || [];
  const filtered = activities.filter(a => 
    a.date === selectedDate || (a.repeatWeekly && new Date(a.date).getDay() === new Date(selectedDate).getDay())
  );

  if (!filtered.length) {
    list.textContent = "××™×Ÿ ×¤×¢×™×œ×•×™×•×ª ×‘×ª××¨×™×š ×–×”.";
  } else {
    filtered.forEach(a => {
     const item = document.createElement("div");
item.className = "activity-item";

// ×›×¤×ª×•×¨ ×¢×¨×™×›×”
const editBtn = document.createElement("button");
editBtn.textContent = "âœï¸";
editBtn.style.background = "#3b82f6";   // ×›×—×•×œ
editBtn.style.color = "white";
editBtn.style.border = "none";
editBtn.style.padding = "3px 6px";
editBtn.style.borderRadius = "4px";
editBtn.style.cursor = "pointer";
editBtn.onclick = () => openEditActivityModal(kidId, kid, a);

// ×˜×§×¡×˜ ×”×¤×¢×™×œ×•×ª
const textSpan = document.createElement("span");
textSpan.textContent = `${a.date} ${a.time || ""} - ${a.title}${a.repeatWeekly ? " ğŸ”" : ""}${a.isTransport ? " ğŸš—" : ""}`;

// ×›×¤×ª×•×¨ ××—×™×§×”
const delBtn = document.createElement("button");
delBtn.textContent = "Ã—";
delBtn.style.background = "red";
delBtn.style.color = "white";
delBtn.style.border = "none";
delBtn.style.padding = "2px 6px";
delBtn.style.borderRadius = "4px";
delBtn.style.cursor = "pointer";
delBtn.onclick = () => {
  const updated = activities.filter(act => act.id !== a.id);
  userKidsRef.child(kidId).child("activities").set(updated);
  openKidModal(kidId, { ...kid, activities: updated });
};

// ×”×•×¡×¤×” ×œ×©×•×¨×”
item.appendChild(editBtn);
item.appendChild(textSpan);
item.appendChild(delBtn);

list.appendChild(item);


    });
  }
 
  // ×˜×•×¤×¡ ×”×•×¡×¤×ª ×¤×¢×™×œ×•×ª
  const form = document.createElement("form");
  form.className = "add-activity-form";

  const dateInput = document.createElement("input");
  dateInput.type = "date"; dateInput.required = true; dateInput.value = selectedDate;

  const timeInput = document.createElement("input");
  timeInput.type = "time"; timeInput.placeholder = "×©×¢×”";

  const titleInput = document.createElement("input");
  titleInput.type = "text"; titleInput.required = true; titleInput.placeholder = "×›×•×ª×¨×ª ×¤×¢×™×œ×•×ª";

  // Checkbox ×”×¡×¢×” (××•×˜×•)
  const transportInput = document.createElement("input");
  transportInput.type = "checkbox";
  const transportLabel = document.createElement("label");
  transportLabel.textContent = " ğŸš— ";
  transportLabel.appendChild(transportInput);

  // Checkbox ×¤×¢×™×œ×•×ª ×—×•×–×¨×ª
  const repeatInput = document.createElement("input");
  repeatInput.type = "checkbox";
  const repeatLabel = document.createElement("label");
  repeatLabel.textContent = "×¤×¢×™×œ×•×ª ×—×•×–×¨×ª ×©×‘×•×¢×™×ª ";
  repeatLabel.appendChild(repeatInput);

  // Checkbox ×”×•×“×¢×” ×§×‘×•×¢×” (×¢× ID ×¢×•×‘×“!)
  const permanentCheckbox = document.createElement("input");
  permanentCheckbox.type = "checkbox";
  permanentCheckbox.id = "isPermanent";
  
  const permanentLabel = document.createElement("label");
  permanentLabel.textContent = "×”×•×“×¢×” ×§×‘×•×¢×” ";
  permanentLabel.setAttribute("for", "isPermanent");
  permanentLabel.appendChild(permanentCheckbox);

  
  const addBtn = document.createElement("button");
  addBtn.type = "submit"; addBtn.textContent = "×”×•×¡×£ ×¤×¢×™×œ×•×ª";

  form.appendChild(dateInput);
  form.appendChild(timeInput);
  form.appendChild(titleInput);
  form.appendChild(repeatLabel);
  form.appendChild(permanentLabel);
  form.appendChild(transportLabel); 
  form.appendChild(addBtn);

  
  form.addEventListener("submit", e => {
    e.preventDefault();
    const newActivity = {
      id: "a_" + Date.now(),
      date: dateInput.value,
      time: timeInput.value,
      title: titleInput.value,
      repeatWeekly: repeatInput.checked,
      isPermanent: permanentCheckbox.checked,
      isTransport: transportInput.checked
    };
    userKidsRef.child(kidId).child("activities").set([...activities, newActivity]);
    openKidModal(kidId, { ...kid, activities: [...activities, newActivity] });
  });

  modalContent.appendChild(list);
  modalContent.appendChild(form);

  modalBackdrop.style.display = "flex";
}
//××•×“×œ ×¢×¨×™×›×”
  function openEditActivityModal(kidId, kid, activity) {
  modalTitle.textContent = "×¢×¨×™×›×ª ×¤×¢×™×œ×•×ª";
  modalContent.innerHTML = "";

  const form = document.createElement("form");
  form.className = "add-activity-form";

  const dateInput = document.createElement("input");
  dateInput.type = "date";
  dateInput.value = activity.date;

  const timeInput = document.createElement("input");
  timeInput.type = "time";
  timeInput.value = activity.time;

  const titleInput = document.createElement("input");
  titleInput.type = "text";
  titleInput.value = activity.title;

  const repeatInput = document.createElement("input");
  repeatInput.type = "checkbox";
  repeatInput.checked = activity.repeatWeekly;
  const repeatLabel = document.createElement("label");
  repeatLabel.textContent = "×¤×¢×™×œ×•×ª ×—×•×–×¨×ª ×©×‘×•×¢×™×ª";
  repeatLabel.appendChild(repeatInput);

  const permanentInput = document.createElement("input");
  permanentInput.type = "checkbox";
  permanentInput.checked = activity.isPermanent;
  const permanentLabel = document.createElement("label");
  permanentLabel.textContent = "×”×•×“×¢×” ×§×‘×•×¢×”";
  permanentLabel.appendChild(permanentInput);

  const transportInput = document.createElement("input");
  transportInput.type = "checkbox";
  transportInput.checked = activity.isTransport;
  const transportLabel = document.createElement("label");
  transportLabel.textContent = " ğŸš— ";
  transportLabel.appendChild(transportInput);

  const saveBtn = document.createElement("button");
  saveBtn.type = "submit";
  saveBtn.textContent = "×©××•×¨ ×©×™× ×•×™×™×";

  form.appendChild(dateInput);
  form.appendChild(timeInput);
  form.appendChild(titleInput);
  form.appendChild(repeatLabel);
  form.appendChild(permanentLabel);
  form.appendChild(transportLabel);
  form.appendChild(saveBtn);

  form.addEventListener("submit", e => {
    e.preventDefault();

    const updatedAct = {
      ...activity,
      date: dateInput.value,
      time: timeInput.value,
      title: titleInput.value,
      repeatWeekly: repeatInput.checked,
      isPermanent: permanentInput.checked,
      isTransport: transportInput.checked
    };

    const updatedList = kid.activities.map(a => a.id === activity.id ? updatedAct : a);

    userKidsRef.child(kidId).child("activities").set(updatedList);
    openKidModal(kidId, { ...kid, activities: updatedList });
  });

  modalContent.appendChild(form);
  modalBackdrop.style.display = "flex";
}

//closeModal.onclick = () => { modalBackdrop.style.display = "none"; currentKidId = null; };
  closeModal.addEventListener("click", closeModalFn);

//modalBackdrop.onclick = e => { if (e.target === modalBackdrop) closeModal.onclick(); };
modalBackdrop.onclick = e => { if (e.target === modalBackdrop) closeModalFn(); };
// ====== ×¢×“×›×•×Ÿ ×¨×©×™××ª ×¤×¢×™×œ×•×™×•×ª ××•×˜×•××˜×™×ª ×›×©××©× ×™× ××ª ×”×ª××¨×™×š ======
dateFilter.addEventListener("change", () => {
  if (currentKidId) {
    userKidsRef.child(currentKidId).once("value").then(snap => {
    if (snap.exists()) {
      openKidModal(currentKidId, snap.val());
    }
  });
  }
});
</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/SW.js")
    .then(() => console.log("SW registered"))
    .catch(err => console.error("SW failed:", err));
}
</script>

</body>
</html>
